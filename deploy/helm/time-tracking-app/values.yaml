nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: false
  name: ""
  automountServiceAccountToken: false

backend:
  deployment:
    replicaCount: 1
    image:
      repository: "ghcr.io/savevskii/time-tracking-app"
      tag: "main"
      pullPolicy: IfNotPresent
    initContainers:
      - name: wait-for-keycloak
        image: busybox:1.36
        command:
          - sh
          - -c
          - |
            until nc -z {{ printf "%s-keycloak.%s.svc.cluster.local" .Release.Name .Release.Namespace }} 80; do echo "Waiting for Keycloak..."; sleep 2; done
    resources:
      requests:
        cpu: "250m"
        memory: "512Mi"
      limits:
        memory: "1Gi"
    envFrom: []
    env: []
  service:
    type: ClusterIP
    port: 8080

frontend:
  enabled: true
  replicaCount: 1
  image:
    repository: "ghcr.io/savevskii/time-tracking-app-ui"
    tag: "latest"
    pullPolicy: IfNotPresent
  containerPort: 80
  envFrom: []
  env: []
  resources:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      memory: "256Mi"
  service:
    type: ClusterIP
    port: 80

ingress:
  enabled: false

egress:
  enabled: false

imagePullSecrets: []

# Subchart defaults
postgresql:
  image:
    registry: docker.io
    repository: bitnamilegacy/postgresql
    tag: 17.6.0-debian-12-r4
  enabled: true
  auth:
    enablePostgresUser: true
    postgresPassword: "postgres_admin_password"
    username: "timetracking_user"
    password: "timetracking123"
    database: "timetracking"
  primary:
    resources:
      requests:
        cpu: 500m
        memory: 1Gi
      limits:
        cpu: 500m
        memory: 1Gi
    persistence:
      enabled: false
    initdb:
      user: "postgres"
      password: "postgres_admin_password"
      scripts:
        00_enable-extensions.sql: |
          CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
          CREATE EXTENSION IF NOT EXISTS "pgcrypto";
        01_create_keycloak_db.sql: |
          -- Create dedicated user for Keycloak
          CREATE USER keycloak_user WITH PASSWORD 'keycloak123';
          
          -- Create Keycloak database owned by that user
          CREATE DATABASE keycloak OWNER keycloak_user;
          
          -- Optional: make sure privileges are explicit
          GRANT ALL PRIVILEGES ON DATABASE keycloak TO keycloak_user;
  readReplicas:
    replicaCount: 0
  metrics:
    enabled: false

keycloak:
  image:
    registry: docker.io
    repository: bitnamilegacy/keycloak
    tag: 26.3.3-debian-12-r0
  enabled: true
  auth:
    adminUser: admin
    adminPassword: topsecret
  service:
    type: ClusterIP
  ingress:
    enabled: true
    ingressClassName: nginx
    hostname: keycloak.localtest.me
    tls: false
  resources:
    requests:
      cpu: 250m
      memory: 1Gi
    limits:
      cpu: 1
      memory: 1Gi
  httpRelativePath: "/"
  postgresql:
    enabled: false
  externalDatabase:
    host: '{{ printf "%s-postgresql.%s.svc.cluster.local" .Release.Name .Release.Namespace }}'
    port: 5432
    user: keycloak_user
    password: keycloak123
    database: keycloak
    schema: public
  extraEnvVars:
    - name: KEYCLOAK_EXTRA_ARGS
      value: "--import-realm"
  extraVolumes:
    - name: dev-realm
      configMap:
        name: keycloak-realm
  extraVolumeMounts:
    - name: dev-realm
      mountPath: /opt/bitnami/keycloak/data/import
      readOnly: true
  initContainers:
    - name: wait-for-db
      image: busybox:1.36
      command:
        - sh
        - -c
        - |
          until nc -z {{ printf "%s-postgresql.%s.svc.cluster.local" .Release.Name .Release.Namespace }} 5432; do echo "Waiting for PostgreSQL..."; sleep 2; done
